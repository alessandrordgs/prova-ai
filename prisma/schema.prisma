generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid(7))
  username  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Chat      Chat[]
  Source    Source[]
}

model Chat {
  id        String    @id @default(uuid(7))
  userId    String
  name      String
  banca     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  Message   Message[]
  Source    Source[]
}

model Message {
  id        String   @id @default(uuid(7))
  chatId    String
  role      String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model Source {
  id           String         @id @default(uuid(7))
  userId       String
  name         String
  chatId       String
  progress     Float          @default(0)
  status       String         @default("pending")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  Chat         Chat           @relation(fields: [chatId], references: [id])
  User         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  SourceChunks SourceChunks[]
}

model SourceChunks {
  id        String                 @id @default(uuid(7))
  sourceId  String
  content   String
  metadata  Json?
  embedding Unsupported("vector")?
  createdAt DateTime               @default(now())
  updatedAt DateTime @updatedAt 
  Source    Source                 @relation(fields: [sourceId], references: [id], onDelete: Cascade)

  @@index([sourceId])
  @@index([embedding], map: "source_chunk_embedding_idx")
}
